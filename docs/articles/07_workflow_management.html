<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>7 - Workflow management • mbtools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="7 - Workflow management">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mbtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.40.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/00_qa.html">0 - Quality control of sequencing data</a>
    </li>
    <li>
      <a href="../articles/01_preprocessing.html">1 - Preprocessing of sequencing data</a>
    </li>
    <li>
      <a href="../articles/02_amplicon_sequencing.html">2 - Amplicon sequencing analysis</a>
    </li>
    <li>
      <a href="../articles/03_shotgun_align.html">3 - Shotgun data - alignments</a>
    </li>
    <li>
      <a href="../articles/04_long_align.html">4 - Long read data - alignments</a>
    </li>
    <li>
      <a href="../articles/05_lineage.html">5 - Lineage calling with SLIMM</a>
    </li>
    <li>
      <a href="../articles/06_counting.html">6 - Reference counting</a>
    </li>
    <li>
      <a href="../articles/07_workflow_management.html">7 - Workflow management</a>
    </li>
    <li>
      <a href="../articles/08_sra.html">8 - Submitting data to SRA</a>
    </li>
    <li>
      <a href="../articles/09_plate_layouts.html">9 - Plate Layouts</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Gibbons-Lab/mbtools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="07_workflow_management_files/htmlwidgets-1.5.1/htmlwidgets.js"></script><link href="07_workflow_management_files/vis-4.20.1/vis.css" rel="stylesheet">
<script src="07_workflow_management_files/vis-4.20.1/vis.min.js"></script><script src="07_workflow_management_files/visNetwork-binding-2.0.8/visNetwork.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>7 - Workflow management</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Gibbons-Lab/mbtools/blob/master/vignettes/07_workflow_management.Rmd"><code>vignettes/07_workflow_management.Rmd</code></a></small>
      <div class="hidden name"><code>07_workflow_management.Rmd</code></div>

    </div>

    
    
<p>The API design of <code>mbtools</code> makes it well suited for workflow managers. This is particularly useful when you have longer analysis chains. For instance, let’s look at an example workflow. We start with the config:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(mbtools)</span></code></pre></div>
<pre><code>## Also loading:</code></pre>
<pre><code>##   - dada2=1.12.1
##   - data.table=1.12.6
##   - ggplot2=3.2.1
##   - magrittr=1.5
##   - phyloseq=1.28.0
##   - ShortRead=1.42.0
##   - yaml=2.2.0</code></pre>
<pre><code>## Found tools:</code></pre>
<pre><code>##   - minimap2=2.17-r941
##   - slimm=0.3.4
##   - samtools=1.9</code></pre>
<pre><code>## 
## Attaching package: 'mbtools'</code></pre>
<pre><code>## The following object is masked _by_ 'package:BiocGenerics':
## 
##     normalize</code></pre>
<pre><code>## The following object is masked from 'package:graphics':
## 
##     layout</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>ref &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata/genomes/zymo_mock.fna.gz"</span>, <span class="dt">package =</span> <span class="st">"mbtools"</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>reads &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata/nanopore"</span>, <span class="dt">package =</span> <span class="st">"mbtools"</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a>conf_p &lt;-<span class="st"> </span><span class="kw"><a href="../reference/config_preprocess.html">config_preprocess</a></span>(</span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="dt">trimLeft =</span> <span class="dv">10</span>,</span>
<span id="cb9-6"><a href="#cb9-6"></a>    <span class="dt">maxEE =</span> <span class="ot">Inf</span>,</span>
<span id="cb9-7"><a href="#cb9-7"></a>    <span class="dt">maxN =</span> <span class="ot">Inf</span>,</span>
<span id="cb9-8"><a href="#cb9-8"></a>    <span class="dt">truncQ =</span> <span class="dv">0</span>,</span>
<span id="cb9-9"><a href="#cb9-9"></a>    <span class="dt">out_dir =</span> <span class="st">"preprocessed"</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>)</span>
<span id="cb9-11"><a href="#cb9-11"></a>conf_a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/config_align.html">config_align</a></span>(</span>
<span id="cb9-12"><a href="#cb9-12"></a>    <span class="dt">reference =</span> ref,</span>
<span id="cb9-13"><a href="#cb9-13"></a>    <span class="dt">alignment_dir =</span> <span class="st">"alignments"</span>,</span>
<span id="cb9-14"><a href="#cb9-14"></a>    <span class="dt">threads =</span> <span class="dv">4</span>,</span>
<span id="cb9-15"><a href="#cb9-15"></a>    <span class="dt">use_existing =</span> <span class="ot">FALSE</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>)</span>
<span id="cb9-17"><a href="#cb9-17"></a>conf_c &lt;-<span class="st"> </span><span class="kw"><a href="../reference/config_count.html">config_count</a></span>(</span>
<span id="cb9-18"><a href="#cb9-18"></a>    <span class="dt">reference =</span> ref,</span>
<span id="cb9-19"><a href="#cb9-19"></a>    <span class="dt">weights =</span> <span class="ot">TRUE</span>,</span>
<span id="cb9-20"><a href="#cb9-20"></a>    <span class="dt">maxit =</span> <span class="dv">1000</span>,</span>
<span id="cb9-21"><a href="#cb9-21"></a>    <span class="dt">threads =</span> <span class="dv">4</span></span>
<span id="cb9-22"><a href="#cb9-22"></a>)</span></code></pre></div>
<p>Where our actual workflow looks like this:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>counting &lt;-<span class="st"> </span><span class="kw"><a href="../reference/find_read_files.html">find_read_files</a></span>(reads) <span class="op">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="st">            </span><span class="kw"><a href="../reference/quality_control.html">quality_control</a></span>(<span class="dt">min_score =</span> <span class="dv">20</span>) <span class="op">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="st">            </span><span class="kw"><a href="../reference/preprocess.html">preprocess</a></span>(conf_p) <span class="op">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="st">            </span><span class="kw"><a href="../reference/align_long_reads.html">align_long_reads</a></span>(conf_a) <span class="op">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="st">            </span><span class="kw"><a href="../reference/count_references.html">count_references</a></span>(conf_c)</span></code></pre></div>
<p>This looks pretty clear but it will run the entire workflow everytime we execute the code. This is particularly costly if we only want to change some parameters of the last step. For instance to check what the effect of weighting on counting is.</p>
<p>In this case we don’t need to run preprocessing and aligning again. We could implement this with several if-statements and by saving the immediate outputs but this makes the code way more convoluted. Also this would not tell us if the input files changed.</p>
<div id="workflow-management-with-drake" class="section level2">
<h2 class="hasAnchor">
<a href="#workflow-management-with-drake" class="anchor"></a>Workflow management with drake</h2>
<p>One popular workflow manager for R is <a href="https://ropensci.github.io/drake/">drake</a> which will automatically track what needs to be recomputed and what not. This requires only minimal changes to <code>mbtools</code> workflows, mostly wrapping all input and output location with <code>file_in</code> and <code>file_out</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(drake)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'drake'</code></pre>
<pre><code>## The following object is masked from 'package:ShortRead':
## 
##     clean</code></pre>
<pre><code>## The following object is masked from 'package:S4Vectors':
## 
##     expand</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>reads &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/file_in">file_in</a></span>(<span class="st">"../inst/extdata/nanopore"</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>plan &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/drake_plan">drake_plan</a></span>(</span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="dt">files =</span> <span class="kw"><a href="../reference/find_read_files.html">find_read_files</a></span>(reads),</span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="dt">qa =</span> <span class="kw"><a href="../reference/quality_control.html">quality_control</a></span>(files, <span class="dt">min_score =</span> <span class="dv">20</span>),</span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="dt">qual_plot =</span> <span class="kw">ggsave</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/file_out">file_out</a></span>(<span class="st">"quals.png"</span>), qa<span class="op">$</span>quality_plot),</span>
<span id="cb15-7"><a href="#cb15-7"></a>    <span class="dt">processed =</span> <span class="kw"><a href="../reference/preprocess.html">preprocess</a></span>(files, conf_p),</span>
<span id="cb15-8"><a href="#cb15-8"></a>    <span class="dt">aligned =</span> <span class="kw"><a href="../reference/align_long_reads.html">align_long_reads</a></span>(processed, conf_a),</span>
<span id="cb15-9"><a href="#cb15-9"></a>    <span class="dt">counting =</span> <span class="kw"><a href="../reference/count_references.html">count_references</a></span>(aligned, conf_c)</span>
<span id="cb15-10"><a href="#cb15-10"></a>)</span></code></pre></div>
<p>We can take a look if our plan makes sense:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/clean">clean</a></span>()</span>
<span id="cb16-2"><a href="#cb16-2"></a>dconf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/drake_config">drake_config</a></span>(plan)</span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/vis_drake_graph">vis_drake_graph</a></span>(dconf)</span></code></pre></div>
<div id="htmlwidget-9b841de324d41155df19" style="width:700px;height:432.632880098888px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-9b841de324d41155df19">{"x":{"nodes":{"id":["conf_c","reads","conf_p","conf_a","files","qa","processed","qual_plot","aligned","p-OF2WC3DTFZYG4ZY","counting"],"imported":[true,true,true,true,false,false,false,false,false,false,false],"label":["conf_c","reads","conf_p","conf_a","files","qa","processed","qual_plot","aligned","file quals.png","counting"],"status":["imported","imported","imported","imported","outdated","outdated","outdated","outdated","outdated","outdated","outdated"],"type":["object","object","object","object","object","object","object","object","object","file","object"],"font.size":[20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#000000","#000000","#000000","#000000","#000000","#000000","#000000"],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","square","dot"],"level":[1,1,1,1,2,3,3,4,4,5,5],"x":[-1,-1,-1,-1,-0.5,0,0,0.5,0.5,1,1],"y":[-1,-0.333333333333333,0.333333333333333,1,-2.22044604925031e-16,-0.555555555555556,0.555555555555555,-0.555555555555556,0.555555555555555,-0.555555555555556,0.555555555555555]},"edges":{"from":["conf_c","reads","conf_p","conf_a","files","files","qa","qual_plot","processed","aligned"],"to":["counting","files","processed","aligned","qa","processed","qual_plot","p-OF2WC3DTFZYG4ZY","aligned","counting"],"arrows":["to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Outdated","Imported","Object","File"],"color":["#000000","#1874CD","#888888","#888888"],"shape":["dot","dot","dot","square"],"font.color":["black","black","black","black"],"font.size":[20,20,20,20],"id":[2,5,7,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><p>As we see <code>drake</code> knows we have to run everything. Let’s execute the plan and see what happens. Note, the <code>lock_envir</code> argument which is currently necessary.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/make">make</a></span>(plan, <span class="dt">lock_envir =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## target files</code></pre>
<pre><code>## target qa</code></pre>
<pre><code>## INFO [2019-11-05 08:21:21] Running quality assay for forward reads from 3 files.
## INFO [2019-11-05 08:21:34] Median per base error is 12.589% (median score = 9.00).
## INFO [2019-11-05 08:21:34] Mean per cycle entropy is 1.578 (in [0, 2]).
## INFO [2019-11-05 08:21:34] On average we have 1000.00 +- 0.00 reads per file.</code></pre>
<pre><code>## target processed</code></pre>
<pre><code>## INFO [2019-11-05 08:21:42] Preprocessing reads for 3 single-end samples...
## INFO [2019-11-05 08:21:47] 2.99e+03/3e+03 (99.53%) reads passed preprocessing.</code></pre>
<pre><code>## target qual_plot</code></pre>
<pre><code>## Target qual_plot messages:
##   Saving 7.29 x 4.51 in image</code></pre>
<pre><code>## target aligned</code></pre>
<pre><code>## INFO [2019-11-05 08:21:48] Aligning 3 samples on 4 threads. Keeping up to 100 secondary alignments.
## INFO [2019-11-05 08:21:51] Finished aligning even1.
## INFO [2019-11-05 08:21:54] Finished aligning even2.
## INFO [2019-11-05 08:21:57] Finished aligning even3.</code></pre>
<pre><code>## target counting</code></pre>
<pre><code>## INFO [2019-11-05 08:21:57] Getting reference lengths from /Library/Frameworks/R.framework/Versions/3.6/Resources/library/mbtools/extdata/genomes/zymo_mock.fna.gz...
## INFO [2019-11-05 08:21:57] Normalized IDs. Starting counting...</code></pre>
<p>We can access our final output.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/readd">readd</a></span>(counting)<span class="op">$</span>counts <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>()</span></code></pre></div>
<pre><code>##     reference     counts effective_length sample
## 1: AE004091.2   3.193363          6261124  even1
## 2: AE006468.2  26.257417          4854170  even1
## 3: AE016830.1 120.312710          3214751  even1
## 4: AE017341.1   2.296111         19049682  even1
## 5: AL009126.3 156.701221          4212326  even1
## 6: AL591824.1 168.907323          2941248  even1</code></pre>
<p>Now if we check our plan…</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/vis_drake_graph">vis_drake_graph</a></span>(dconf)</span></code></pre></div>
<div id="htmlwidget-a0846c9cd8803738e5c5" style="width:700px;height:432.632880098888px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-a0846c9cd8803738e5c5">{"x":{"nodes":{"id":["conf_c","reads","conf_p","conf_a","files","qa","processed","qual_plot","aligned","p-OF2WC3DTFZYG4ZY","counting"],"imported":[true,true,true,true,false,false,false,false,false,false,false],"label":["conf_c","reads","conf_p","conf_a","files\n0.02s","qa\n21.12s","processed\n5.329s","qual_plot\n0.691s","aligned\n8.462s","file quals.png","counting\n0.636s"],"status":["imported","imported","imported","imported","up to date","up to date","up to date","up to date","up to date","up to date","up to date"],"type":["object","object","object","object","object","object","object","object","object","file","object"],"font.size":[20,20,20,20,20,20,20,20,20,20,20],"color":["#1874CD","#1874CD","#1874CD","#1874CD","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22","#228B22"],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","square","dot"],"level":[1,1,1,1,2,3,3,4,4,5,5],"x":[-1,-1,-1,-1,-0.5,0,0,0.5,0.5,1,1],"y":[-1,-0.333333333333333,0.333333333333333,1,-2.22044604925031e-16,-0.555555555555556,0.555555555555555,-0.555555555555556,0.555555555555555,-0.555555555555556,0.555555555555555]},"edges":{"from":["conf_c","reads","conf_p","conf_a","files","files","qa","qual_plot","processed","aligned"],"to":["counting","files","processed","aligned","qa","processed","qual_plot","p-OF2WC3DTFZYG4ZY","aligned","counting"],"arrows":["to","to","to","to","to","to","to","to","to","to"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","physics":false},"manipulation":{"enabled":false},"edges":{"smooth":false},"physics":{"stabilization":false},"interaction":{"navigationButtons":true}},"groups":null,"width":null,"height":null,"idselection":{"enabled":false,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)"},"main":{"text":"Dependency graph","style":"font-family:Georgia, Times New Roman, Times, serif;font-weight:bold;font-size:20px;text-align:center;"},"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","highlight":{"enabled":false,"hoverNearest":false,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":true,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"left","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Up to date","Imported","Object","File"],"color":["#228B22","#1874CD","#888888","#888888"],"shape":["dot","dot","dot","square"],"font.color":["black","black","black","black"],"font.size":[20,20,20,20],"id":[1,5,7,9]},"nodesToDataframe":true},"igraphlayout":{"type":"square"},"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><p>We see that everything is up-to-date. So running the plan again would do nothing:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/make">make</a></span>(plan)</span></code></pre></div>
<pre><code>## All targets are already up to date.</code></pre>
<p>Now lets change the weighting for counting.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>conf_c<span class="op">$</span>weights =<span class="st"> </span><span class="ot">FALSE</span></span></code></pre></div>
<p><code>drake</code> detects that we only have to rerun the counting.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/outdated">outdated</a></span>(dconf)</span></code></pre></div>
<pre><code>## [1] "counting"</code></pre>
<p>Which we can do with running counting again.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw"><a href="https://www.rdocumentation.org/packages/drake/topics/make">make</a></span>(plan, <span class="dt">lock_envir =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## target counting</code></pre>
<pre><code>## INFO [2019-11-05 08:21:58] Getting reference lengths from /Library/Frameworks/R.framework/Versions/3.6/Resources/library/mbtools/extdata/genomes/zymo_mock.fna.gz...
## INFO [2019-11-05 08:21:58] Normalized IDs. Starting counting...</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#workflow-management-with-drake">Workflow management with drake</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Christian Diener.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
